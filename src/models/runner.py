import gc

import pandas
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import OrdinalEncoder

from src.models.gridSearch import run_grid_searches
from src.models.trainer import run_all_models
from src.utils.enums import Mode


def run_models(file, mode):
    data = load_data(file)
    data, labels = split_data(data)
    print(labels.value_counts())
    data_train, data_test, label_train, label_test = train_test_split(data, labels, random_state=100, test_size=0.25)
    del data
    del labels
    gc.collect()

    if mode is Mode.TRAIN:
        run_all_models(data_train, data_test, label_train, label_test)
    elif mode is Mode.SEARCH:
        run_grid_searches(data_train, label_train)
    return None


def load_data(file):
    print("Loading data")
    return pandas.read_csv(file)


def split_data(data):
    data.drop(labels="Unnamed: 0", axis=1, inplace=True)
    labels = pandas.DataFrame(data['label'])
    data.drop(labels='label', axis=1)

    enc = OrdinalEncoder()
    data = enc.fit_transform(data)

    return data, labels
