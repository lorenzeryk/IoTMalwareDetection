import os

import pandas

def test_load_data_pandas():
    data = pandas.read_csv("dataset/CTU-Honeypot-Capture-4-1.log.labeled")
    return data


def load_data(size):
    dataframes = []
    for file in os.listdir("dataset/"):
        if file.endswith('.labeled'):
            try:
                dataframes.append(pandas.read_table(filepath_or_buffer="dataset/"+file, nrows=size, dtype={"ts": "string"}))
            except:
                print(file)

    return dataframes


def update_labels(df_c):
    df_c.loc[(df_c.label == '-   Malicious   PartOfAHorizontalPortScan'), 'label'] = 'PartOfAHorizontalPortScan'
    df_c.loc[(df_c.label == '(empty)   Malicious   PartOfAHorizontalPortScan'), 'label'] = 'PartOfAHorizontalPortScan'
    df_c.loc[(df_c.label == '-   Malicious   PartOfAHorizontalPortScan-Attack'), 'label'] = 'PartOfAHorizontalPortScan'
    df_c.loc[(df_c.label == '-   Malicious   C&C-PartOfAHorizontalPortScan'), 'label'] = 'PartOfAHorizontalPortScan'
    df_c.loc[(df_c.label == '-   Malicious   Okiru'), 'label'] = 'Okiru'
    df_c.loc[(df_c.label == '(empty)   Malicious   Okiru'), 'label'] = 'Okiru'
    df_c.loc[(df_c.label == '-   Benign   -'), 'label'] = 'Benign'
    df_c.loc[(df_c.label == '-   benign   -'), 'label'] = 'Benign'
    df_c.loc[(df_c.label == '(empty)   Benign   -'), 'label'] = 'Benign'
    df_c.loc[(df_c.label == '-   Malicious   DDoS'), 'label'] = 'DDoS'
    df_c.loc[(df_c.label == '(empty)   Malicious   DDoS'), 'label'] = 'DDoS'
    df_c.loc[(df_c.label == '-   Malicious   C&C'), 'label'] = 'C&C'
    df_c.loc[(df_c.label == '(empty)   Malicious   C&C'), 'label'] = 'C&C'
    df_c.loc[(df_c.label == '-   Malicious   Attack'), 'label'] = 'Attack'
    df_c.loc[(df_c.label == '(empty)   Malicious   Attack'), 'label'] = 'Attack'
    df_c.loc[(df_c.label == '-   Malicious   C&C-HeartBeat'), 'label'] = 'C&C-HeartBeat'
    df_c.loc[(df_c.label == '-   Malicious   C&C-HeartBeat-Attack'), 'label'] = 'C&C-HeartBeat-Attack'
    df_c.loc[(df_c.label == '(empty)   Malicious   C&C-HeartBeat'), 'label'] = 'C&C-HeartBeat'
    df_c.loc[(df_c.label == '-   Malicious   C&C-FileDownload'), 'label'] = 'C&C-FileDownload'
    df_c.loc[(df_c.label == '-   Malicious   C&C-Torii'), 'label'] = 'C&C-Torii'
    df_c.loc[(df_c.label == '-   Malicious   C&C-HeartBeat-FileDownload'), 'label'] = 'C&C-HeartBeat-FileDownload'
    df_c.loc[(df_c.label == '-   Malicious   FileDownload'), 'label'] = 'FileDownload'
    df_c.loc[(df_c.label == '-   Malicious   C&C-Mirai'), 'label'] = 'C&C-Mirai'
    df_c.loc[(df_c.label == '-   Malicious   Okiru-Attack'), 'label'] = 'Okiru-Attack'

    return df_c


def preprocess_data(size):
    dataframes = load_data(size)
    full_data = pandas.concat(dataframes)
    print(full_data.columns.tolist())
    full_data.rename(columns={'tunnel_parents   label   detailed-label':'label'}, inplace=True)
    full_data = update_labels(full_data)
    print(full_data['label'].value_counts())

    full_data.to_csv("processedData/combined4000000.csv")

# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    preprocess_data(8000000)

# See PyCharm help at https://www.jetbrains.com/help/pycharm/
